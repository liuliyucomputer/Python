# Oracle数据库安装配置

## 1. 安装前准备

### 1.1 系统要求
Oracle Database 19c对系统有以下基本要求：

#### 1.1.1 硬件要求
- **CPU**：至少2 GHz处理器（推荐4 GHz或更高）
- **内存**：至少2 GB RAM（推荐8 GB或更高）
- **磁盘空间**：
  - 企业版：至少7.2 GB
  - 标准版：至少7.2 GB
  - 快速版（XE）：至少2 GB
- **交换空间**：
  - RAM < 8 GB：1.5倍RAM
  - RAM ≥ 8 GB：等于RAM

#### 1.1.2 软件要求
- **操作系统**：
  - Windows Server 2016/2019/2022
  - Oracle Linux 7/8
  - Red Hat Enterprise Linux 7/8
  - SUSE Linux Enterprise Server 12/15
- **文件系统**：支持NTFS（Windows）或ext3/ext4/XFS（Linux）
- **网络**：TCP/IP协议支持
- **浏览器**：支持HTML5的现代浏览器（用于Oracle Enterprise Manager）

### 1.2 安装前准备工作

#### 1.2.1 Windows系统准备
1. 确保系统已安装最新的补丁和更新
2. 关闭不必要的服务和防火墙（安装后可重新配置）
3. 创建专用的Oracle安装用户（可选，但推荐）
4. 确保系统有足够的临时空间（至少4 GB）

#### 1.2.2 Linux系统准备
1. 确保系统已安装最新的补丁和更新
   ```bash
   sudo yum update -y  # Oracle Linux/Red Hat
   sudo zypper update -y  # SUSE Linux
   ```
2. 安装必要的依赖包
   ```bash
   sudo yum install -y binutils compat-libcap1 compat-libstdc++-33 gcc gcc-c++ glibc glibc-devel ksh libaio libaio-devel libgcc libstdc++ libstdc++-devel libXi libXtst make sysstat xorg-x11-apps
   ```
3. 配置内核参数
   - 编辑`/etc/sysctl.conf`文件，添加或修改以下参数：
     ```
     fs.file-max = 6815744
     kernel.sem = 250 32000 100 128
     kernel.shmmni = 4096
     kernel.shmall = 1073741824
     kernel.shmmax = 4398046511104
     net.core.rmem_default = 262144
     net.core.rmem_max = 4194304
     net.core.wmem_default = 262144
     net.core.wmem_max = 1048576
     fs.aio-max-nr = 1048576
     net.ipv4.ip_local_port_range = 9000 65500
     ```
   - 应用内核参数：
     ```bash
     sudo sysctl -p
     ```
4. 配置用户限制
   - 编辑`/etc/security/limits.conf`文件，添加以下内容：
     ```
     oracle soft nproc 2047
     oracle hard nproc 16384
     oracle soft nofile 1024
     oracle hard nofile 65536
     oracle soft stack 10240
     oracle hard stack 32768
     ```
5. 创建Oracle用户和组
   ```bash
   sudo groupadd oinstall
   sudo groupadd dba
   sudo useradd -g oinstall -G dba oracle
   sudo passwd oracle
   ```
6. 创建安装目录
   ```bash
   sudo mkdir -p /u01/app/oracle/product/19.0.0/dbhome_1
   sudo mkdir -p /u01/oradata
   sudo chown -R oracle:oinstall /u01
   sudo chmod -R 775 /u01
   ```
7. 配置Oracle用户环境变量
   - 编辑`~oracle/.bash_profile`文件，添加以下内容：
     ```bash
     export ORACLE_BASE=/u01/app/oracle
     export ORACLE_HOME=$ORACLE_BASE/product/19.0.0/dbhome_1
     export ORACLE_SID=ORCL
     export PATH=$ORACLE_HOME/bin:$PATH
     export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH
     ```

## 2. Oracle Database安装

### 2.1 下载Oracle Database软件
1. 访问Oracle官方下载页面：https://www.oracle.com/database/technologies/oracle-database-software-downloads.html
2. 选择适合您系统的Oracle Database版本（推荐Oracle Database 19c）
3. 接受许可协议并下载安装文件

### 2.2 Windows系统安装
1. 解压下载的安装文件
2. 双击`setup.exe`启动安装向导
3. 在安装选项页面，选择"创建并配置单实例数据库"
4. 在系统类页面，选择"服务器类"
5. 在数据库安装选项页面，选择"高级安装"
6. 在产品语言页面，选择需要的语言
7. 在数据库版本页面，选择适合的版本（企业版/标准版）
8. 在安装位置页面，指定Oracle基目录和软件位置
9. 在配置类型页面，选择"一般用途/事务处理"
10. 在数据库标识符页面，指定全局数据库名和SID
11. 在配置选项页面，配置内存、字符集等参数
12. 在管理选项页面，配置Enterprise Manager
13. 在数据库存储页面，指定数据文件位置
14. 在恢复选项页面，配置闪回恢复区
15. 在方案密码页面，设置数据库用户密码
16. 在操作系统组页面，指定用户组
17. 在总结页面，检查安装配置并点击"安装"
18. 等待安装完成，点击"关闭"

### 2.3 Linux系统安装
1. 使用Oracle用户登录系统
2. 解压下载的安装文件
   ```bash
   unzip LINUX.X64_193000_db_home.zip -d $ORACLE_HOME
   ```
3. 进入安装目录并启动安装向导
   ```bash
   cd $ORACLE_HOME
   ./runInstaller
   ```
4. 在安装选项页面，选择"创建并配置单实例数据库"
5. 后续步骤与Windows系统类似，根据向导完成安装
6. 安装完成后，执行提示的脚本
   ```bash
   sudo /u01/app/oracle/product/19.0.0/dbhome_1/root.sh
   ```

## 3. 数据库初始化配置

### 3.1 启动和关闭数据库

#### 3.1.1 使用SQL*Plus
1. 启动数据库：
   ```sql
   sqlplus / as sysdba
   startup
   ```
2. 关闭数据库：
   ```sql
   sqlplus / as sysdba
   shutdown immediate
   ```

#### 3.1.2 使用Oracle Enterprise Manager
1. 打开浏览器，访问Enterprise Manager URL（默认：https://localhost:5500/em）
2. 使用SYSDBA用户登录
3. 在"数据库"页面，点击"启动"或"关闭"按钮

### 3.2 创建用户和表空间

#### 3.2.1 创建表空间
```sql
CREATE TABLESPACE users 
DATAFILE '/u01/oradata/ORCL/users01.dbf' 
SIZE 100M 
AUTOEXTEND ON 
NEXT 10M 
MAXSIZE UNLIMITED;
```

#### 3.2.2 创建用户
```sql
CREATE USER myuser IDENTIFIED BY mypassword 
DEFAULT TABLESPACE users 
TEMPORARY TABLESPACE temp;
```

#### 3.2.3 授予用户权限
```sql
GRANT CONNECT, RESOURCE TO myuser;
GRANT CREATE TABLE, CREATE VIEW TO myuser;
-- 授予查询特定表的权限
GRANT SELECT ON hr.employees TO myuser;
```

### 3.3 配置监听器

#### 3.3.1 查看监听器状态
```bash
lsnrctl status
```

#### 3.3.2 启动监听器
```bash
lsnrctl start
```

#### 3.3.3 停止监听器
```bash
lsnrctl stop
```

#### 3.3.4 配置监听器
编辑监听器配置文件`$ORACLE_HOME/network/admin/listener.ora`：
```
LISTENER = 
  (DESCRIPTION_LIST = 
    (DESCRIPTION = 
      (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
    )
  )
```

### 3.4 配置网络服务名
编辑`tnsnames.ora`文件`$ORACLE_HOME/network/admin/tnsnames.ora`：
```
ORCL = 
  (DESCRIPTION = 
    (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
    (CONNECT_DATA = 
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )
```

## 4. 连接到Oracle数据库

### 4.1 使用SQL*Plus连接

#### 4.1.1 本地连接
```bash
sqlplus username/password@localhost:1521/orcl
# 或使用TNS服务名
 sqlplus username/password@orcl
```

#### 4.1.2 远程连接
```bash
sqlplus username/password@//remote_host:1521/orcl
```

### 4.2 使用Oracle SQL Developer连接
1. 下载并安装Oracle SQL Developer：https://www.oracle.com/tools/downloads/sqldev-downloads.html
2. 打开SQL Developer
3. 点击"新建连接"按钮
4. 填写连接信息：
   - 连接名：任意名称
   - 用户名：数据库用户名
   - 密码：数据库密码
   - 主机名：数据库服务器地址
   - 端口：1521
   - SID/服务名：orcl
5. 点击"测试"按钮测试连接
6. 点击"保存"按钮保存连接
7. 点击"连接"按钮连接到数据库

### 4.3 使用Python连接
```python
import cx_Oracle

# 连接到数据库
connection = cx_Oracle.connect(
    user="username",
    password="password",
    dsn="localhost:1521/orcl"
)

# 创建游标
cursor = connection.cursor()

# 执行SQL语句
cursor.execute("SELECT * FROM employees")

# 获取结果
for row in cursor:
    print(row)

# 关闭游标和连接
cursor.close()
connection.close()
```

## 5. 安装后验证

### 5.1 验证数据库状态
```sql
sqlplus / as sysdba
SELECT name, open_mode FROM v$database;
SELECT instance_name, status FROM v$instance;
```

### 5.2 验证监听器状态
```bash
lsnrctl status
```

### 5.3 验证用户连接
```sql
sqlplus username/password
SELECT user FROM dual;
```

## 6. 常见问题及解决方案

### 6.1 安装过程中遇到的问题

#### 6.1.1 内存不足
- **解决方案**：增加系统内存或调整Oracle内存参数

#### 6.1.2 磁盘空间不足
- **解决方案**：释放磁盘空间或选择不同的安装位置

#### 6.1.3 依赖包缺失（Linux）
- **解决方案**：安装缺失的依赖包
  ```bash
  sudo yum install -y [缺失的包名]
  ```

### 6.2 连接问题

#### 6.2.1 无法连接到数据库
- **解决方案**：
  1. 检查数据库是否启动
  2. 检查监听器是否启动
  3. 检查网络连接
  4. 检查用户名和密码是否正确

#### 6.2.2 TNS:listener does not currently know of service requested in connect descriptor
- **解决方案**：
  1. 检查服务名是否正确
  2. 检查监听器配置
  3. 重启监听器

## 7. 总结

Oracle Database的安装和配置是使用Oracle数据库的第一步。通过本章节的学习，您应该已经掌握了：
- Oracle Database的系统要求
- 安装前的准备工作
- Oracle Database的安装过程
- 数据库的初始化配置
- 如何连接到Oracle数据库
- 常见问题的解决方案

下一章：[Oracle数据库常用SQL指令](03_SQL基础指令.md)